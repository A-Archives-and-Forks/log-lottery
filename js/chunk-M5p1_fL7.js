import{ac as e,G as a,f as s,r as t,d as l,s as r,bf as n,B as o,A as u,c,o as i,a as d,Z as m,_ as v,i as f,b as g,X as h,a4 as p,h as y,bg as b,K as x,a6 as w}from"./chunk-DjcfpCfW.js";import{a as T}from"./chunk-DG41V_YS.js";import{I as M}from"./chunk-KnS5xexs.js";function k(){const l=e.useToast(),r=a(),n=t(""),o=t(""),u=t([]),c=new M("userMsg",["userMsg"],1,["createTime"]),i=async()=>{c.getDataSortedByDateTime("userMsg","dateTime").then(e=>{u.value=e})};return s(()=>{(async()=>{n.value=r.query.userSignature})(),i()}),{sendMsg:function(e){const a={data:e,dateTime:(new Date).toLocaleString()};T(n.value,a).then(a=>{l.open({message:a.msg||"发送成功",type:"success",position:"top-right"}),c.setData("userMsg",{msg:e}),i(),o.value=""})},userInputMsg:o,userMsgArray:u}}const j={class:"flex flex-col justify-around py-4"},D={class:"chat chat-end"},I={class:"chat-header"},_={class:"text-xs opacity-50"},A={class:"chat-bubble break-all whitespace-normal"},K={class:"border-none rounded-2xl bg-base-200 mx-2 p-2 flex flex-col gap-3 items-center justify-center shadow-md mb-8 h-48"},S=["onKeydown"],B=l({__name:"index",setup(e){r.extend(n),r.locale("zh-cn");const a=t(),l=t(),T=t(),M=t(Date.now()),{sendMsg:B,userInputMsg:H,userMsgArray:R}=k();async function q(){B(H.value),a.value.blur(),l.value.scrollTop=l.value.scrollHeight}const z=g(()=>(M.value,R.value.map(e=>({...e,formattedTime:r(e.dateTime).fromNow()}))));return o(()=>R.value.length,()=>{l.value&&setTimeout(()=>{l.value.scrollTop=l.value.scrollHeight},0)},{immediate:!0}),s(()=>{T.value=setInterval(()=>{M.value=Date.now()},6e4)}),u(()=>{T.value&&clearInterval(T.value)}),(e,s)=>(i(),c("div",j,[s[1]||(s[1]=d("div",{class:"h-12 drop-shadow-md shadow-lg"},[d("h2",{class:"text-center text-lg font-bold"}," 发送弹幕 ")],-1)),d("div",{ref_key:"messageArrayRef",ref:l,class:"overflow-y-auto h-[calc(100vh-15rem)]"},[d("ul",null,[(i(!0),c(m,null,v(z.value,e=>(i(),c("li",{key:e.id,class:"mb-3"},[d("div",D,[d("div",I,[d("time",_,f(e.formattedTime),1)]),d("div",A,f(e.msg),1)])]))),128))])],512),d("div",K,[h(d("textarea",{ref_key:"textareaRef",ref:a,"onUpdate:modelValue":s[0]||(s[0]=e=>w(H)?H.value=e:null),class:"textarea w-full rounded-xl border-none bg-transparent focus:outline-none focus:ring-0",placeholder:"发送弹幕 | 只展示您发送过的弹幕",rows:"5",cols:"50",onKeydown:b(x(q,["prevent"]),["enter"])},null,40,S),[[p,y(H)]]),d("div",{class:"w-full flex justify-end"},[d("button",{class:"btn btn-primary w-24 mb-4",onClick:q}," 发送 ")])])]))}});export{B as default};
