import{d as e,l as a,u as l,y as s,B as t,c as i,o as n,Z as o,a as u,p as r,g as v,r as c,i as m,h as d,I as p,v as g,Q as f,X as b,a4 as h,b as k,z as y,_ as I}from"./chunk-DjcfpCfW.js";import{u as w,d as x,g as _}from"./chunk-KnS5xexs.js";import{_ as N}from"./chunk-DP1s4TDo.js";import{_ as j}from"./chunk-TOXtoNEO.js";import"./chunk-DsM932Ci.js";const C={class:"toast toast-top toast-end"},S={key:0,class:"alert alert-error"},U={key:1,class:"alert alert-success"},D={key:2,class:"alert alert-error"},q={class:"flex flex-col items-center gap-6 w-full px-12"},B=["disabled","placeholder"],F=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:y}=a(),I=c("image/*"),_=c(0),N=l(e,"visible"),F=w().globalConfig,M=s.createInstance({name:"imgStore"}),T=c(null),z=k({get:()=>T.value?.fileName||null,set(e){T.value&&e&&(T.value.fileName=e)}}),H=c();async function L(e){if(!e)return void(T.value=null);/image*/.test(e?.type||"")?T.value=e:_.value=3}function Q(){if(T.value){const{data:e,fileName:a}=T.value,l=g();M.setItem(l,{data:e,fileName:a}).then(()=>{_.value=1,async function(){(await M.keys()).length>0&&M.iterate((e,a)=>{F.addImage({id:a,name:e.fileName,url:"Storage"})})}()}).catch(()=>{_.value=2})}}return t(N,e=>{e&&H.value.showDialog()}),(e,a)=>(n(),i(o,null,[u("div",C,[2===_.value?(n(),i("div",S,[u("span",null,m(d(y)("error.uploadFail")),1)])):v("",!0),1===_.value?(n(),i("div",U,[u("span",null,m(d(y)("error.uploadSuccess")),1)])):v("",!0),3===_.value?(n(),i("div",D,[u("span",null,m(d(y)("error.notImage")),1)])):v("",!0)]),r(x,{ref_key:"uploadDialogRef",ref:H,visible:N.value,"onUpdate:visible":a[1]||(a[1]=e=>N.value=e),title:d(y)("dialog.uploadImageTitle"),"submit-func":Q,class:""},{content:p(()=>[u("div",q,[N.value?(n(),f(j,{key:0,"limit-type":I.value,onUploadFile:L},null,8,["limit-type"])):v("",!0),b(u("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),disabled:null===T.value,type:"text",placeholder:d(y)("placeHolder.imageName"),class:"input w-full"},null,8,B),[[h,z.value]])])]),_:1},8,["visible","title"])],64))}}),M={class:""},T={for:"explore"},z={class:"p-0"},H={class:"flex items-center gap-8"},L={class:"avatar h-14"},Q={class:"w-12 h-12 mask mask-squircle hover:w-14 hover:h-14"},R={class:"w-64"},V={class:"overflow-hidden font-bold whitespace-nowrap text-ellipsis"},X=["onClick"],Z=e({__name:"index",setup(e){const{t:l}=a(),v=w().globalConfig,{getImageList:g}=y(v),f=c(0),b=s.createInstance({name:"imgStore"}),h=c(!1);return t(()=>f.value,e=>{0!==e&&setTimeout(()=>{f.value=0},2e3)}),(e,a)=>(n(),i(o,null,[r(F,{visible:h.value,"onUpdate:visible":a[0]||(a[0]=e=>h.value=e)},null,8,["visible"]),u("div",null,[r(N,{title:d(l)("sidebar.imagesManagement")},{buttons:p(()=>[u("div",M,[u("label",T,[u("span",{class:"btn btn-primary btn-sm",onClick:a[1]||(a[1]=e=>h.value=!0)},m(d(l)("button.upload")),1)])])]),_:1},8,["title"]),u("ul",z,[(n(!0),i(o,null,I(d(g),e=>(n(),i("li",{key:e.id,class:"mb-3"},[u("div",H,[u("div",L,[u("div",Q,[r(_,{"img-item":e},null,8,["img-item"])])]),u("div",R,[u("div",V,m(e.name),1)]),u("div",null,[u("button",{class:"btn btn-error btn-xs",onClick:a=>function(e){"Storage"===e.url&&b.removeItem(e.id).then(()=>{v.removeImage(e.id)}),v.removeImage(e.id)}(e)},m(d(l)("button.delete")),9,X)])])]))),128))])])],64))}});export{Z as default};
