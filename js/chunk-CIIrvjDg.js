import{d as e,l as t,ac as a,u as l,y as s,B as i,Q as n,o,I as u,h as r,r as c,a as p,g as d,X as m,a4 as b,b as v,v as f,z as g,c as y,p as h,Z as k,_ as x,i as C}from"./chunk-DjcfpCfW.js";import{_}from"./chunk-DP1s4TDo.js";import{u as w,d as M}from"./chunk-KnS5xexs.js";import{_ as j}from"./chunk-TOXtoNEO.js";import"./chunk-DsM932Ci.js";const I={class:"flex flex-col items-center gap-6 w-full px-12"},N=["disabled"],U=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:g}=t(),y=a.useToast(),h=c("audio/*"),k=l(e,"visible"),x=w().globalConfig,C=s.createInstance({name:"audioStore"}),_=c(null),U=v({get:()=>_.value?.fileName||null,set(e){_.value&&e&&(_.value.fileName=e)}}),D=c();async function S(e){if(!e)return void(_.value=null);/audio*/.test(e?.type||"")?_.value=e:y.open({message:g("error.notAudioFile"),type:"error",position:"top-right"})}function F(){if(_.value){const{data:e,fileName:t}=_.value,a=f();C.setItem(a,{data:e,fileName:t}).then(()=>{y.open({message:g("error.uploadSuccess"),type:"success",position:"top-right"}),async function(){(await C.keys()).length>0&&C.iterate((e,t)=>{x.addMusic({id:t,name:e.fileName,url:"Storage"})})}()}).catch(()=>{y.open({message:g("error.uploadFail"),type:"error",position:"top-right"})})}}return i(k,e=>{e&&D.value.showDialog()}),(e,t)=>(o(),n(M,{ref_key:"uploadDialogRef",ref:D,visible:k.value,"onUpdate:visible":t[1]||(t[1]=e=>k.value=e),title:r(g)("dialog.uploadAudioTitle"),"submit-func":F,class:""},{content:u(()=>[p("div",I,[k.value?(o(),n(j,{key:0,"limit-type":h.value,onUploadFile:S},null,8,["limit-type"])):d("",!0),m(p("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),disabled:null===_.value,type:"text",class:"input w-full"},null,8,N),[[b,U.value]])])]),_:1},8,["visible","title"]))}}),D={class:"flex gap-3"},S={for:"explore"},F={class:"p-0"},L=["title"],A={class:"link hover:text-primary"},B={class:"flex gap-3"},T=["onClick"],q=["onClick"],z=e({__name:"index",setup(e){const{t:a}=t(),l=s.createInstance({name:"audioStore"}),i=w().globalConfig,{getMusicList:n}=g(i),d=c(n),m=c(!1);function b(){i.resetMusicList(),l.clear()}function v(){i.clearMusicList(),l.clear()}return(e,t)=>(o(),y(k,null,[h(U,{visible:m.value,"onUpdate:visible":t[0]||(t[0]=e=>m.value=e)},null,8,["visible"]),p("div",null,[h(_,{title:r(a)("sidebar.musicManagement")},{buttons:u(()=>[p("div",D,[p("button",{class:"btn btn-primary btn-sm",onClick:b},C(r(a)("button.reset")),1),p("label",S,[p("span",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>m.value=!0)},C(r(a)("button.upload")),1)]),p("button",{class:"btn btn-error btn-sm",onClick:v},C(r(a)("button.allDelete")),1)])]),_:1},8,["title"]),p("div",null,[p("ul",F,[(o(!0),y(k,null,x(d.value,e=>(o(),y("li",{key:e.id,class:"flex items-center gap-6 pb-2 mb-3"},[p("div",{class:"mr-12 overflow-hidden w-72 whitespace-nowrap text-ellipsis",title:e.name},[p("a",A,C(e.name),1)],8,L),p("div",B,[p("button",{class:"btn btn-primary btn-xs",onClick:t=>async function(e){i.setCurrentMusic(e,!1)}(e)},C(r(a)("button.play")),9,T),p("button",{class:"btn btn-error btn-xs",onClick:t=>function(e){i.removeMusic(e.id),l.removeItem(e.name)}(e)},C(r(a)("button.delete")),9,q)])]))),128))])])])],64))}});export{z as default};
